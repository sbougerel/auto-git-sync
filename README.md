<a href="https://github.com/sbougerel/autosync-magit"><img src="https://www.gnu.org/software/emacs/images/emacs.png" alt="Emacs Logo" width="80" height="80" align="right"></a>
## autosync-magit.el
*Automatically synchronize content with upstream via magit*

---

[![License GPLv3](https://img.shields.io/badge/license-GPL_v3-green.svg)](http://www.gnu.org/licenses/gpl-3.0.html)
[![CI Result](https://github.com/sbougerel/autosync-magit/actions/workflows/makefile.yml/badge.svg)](https://github.com/sbougerel/autosync-magit/actions)

This package provides a minor mode to automatically synchronise a local git
repository branch with its upstream.  It is intended to be used
exceptionally: when git is used solely to synchronise private content between
devices.  It should never be used with typical repositories and especially
not for team settings.  A typical use case consists in synchronising your
personal notes between devices.

To configure a repository to automatically synchronise, turn on
`autosync-magit-mode` in a buffer, and set the package variables accordingly.
Settings can be made permanent by adding `.dir-locals.el` in repositories you
want to synchronise.  Example:

    ((nil . ((eval . (autosync-magit-mode 1))
             (autosync-magit-commit-message . "My commit message")
             (autosync-magit-pull-interval . 30))))

The configuration above turns on the minor mode for any file visited in the
same directory as `.dir-locals.el` or in its sub-directories.  The
`autosync-magit-commit-message` is used as the commit message for each
commit.  The `autosync-magit-pull-interval` is the minimum interval between
pull attempts, in seconds.  See the documentation for each variable for more
details.

This is a simple package, that lends much of its functionality to `magit`
that does all the work asynchronously under the hood.

### Installation


With `straight.el` and `use-package.el`, add this to your `~/.emacs.d/init.el`:

    (use-package autosync-magit
      :straight (:host github
                 :repo "sbougerel/autosync-magit"
                 :files ("*.el")))

And restart Emacs.  If you're using Doom Emacs, add this to your
`~/.doom.d/packages.el`:

    (package! autosync-magit
      :recipe (:host github
               :repo "sbougerel/autosync-magit"
               :files ("*.el")))

Then add the following to `~/.doom.d/config.el`:

    (use-package! autosync-magit)

Then run `doom sync` to install it.

### Change Log


- 0.2.0 - Use per-directory local variables
  Deprecation of `autosync-magit-dirs` in favor of `.dir-locals.el`.

- 0.1.0 - initial release



### Customization Documentation

#### `autosync-magit-pull-interval`

Minimum interval between pull attempts, in seconds.

This variable is buffer-local.  When the buffer window is
selected (i.e. becomes active), `autosync-magit` attempts to pull
updates from the remotes.  This variable ensures this is not done
overly frequently.

#### `autosync-magit-push-debounce`

Duration in seconds that must elapse before push can be called again.

This variable is buffer-local.  When you save a buffer, wait for
`autosync-magit-push-debounce` to elapse before pushing to the
remote (again).  This ensures that multiple file saves in a short
period of time do not result in multiple pushes.

#### `autosync-magit-commit-message`

Commit message to use for each commit.

This variable is buffer-local.

#### `autosync-magit-dirs`

Alist of `(REPO_DIR . MESSAGE)` that should be synchronised.

*DEPRECATED*: use `.dir-locals.el` instead.  By using
`.dir-locals.el`, you ensure that your private configuration does
not depends on any particular project's location on a host, and
you can set per-repository configuration.  Use of the variable
will be removed in a future version.

REPO_DIR is the top-level directory of the repository to
synchronise.  MESSAGE is the commit message to use when
committing changes.

### Function and Macro Documentation

#### `(autosync-magit-pull REPO_DIR)`

Do `git fetch` then `git merge` from REPO_DIR.
This interactive function is not throttled, it is executed
asynchronously, as soon as it called.

#### `(autosync-magit-push REPO_DIR MESSAGE)`

Do `git add -A`, `git commit -m -a MESSAGE` then `git push` from REPO_DIR.
This interactive function is not debounced, it is executed
asynchronously, as soon as it called.

-----
<div style="padding-top:15px;color: #d0d0d0;">
Markdown README file generated by
<a href="https://github.com/mgalgs/make-readme-markdown">make-readme-markdown.el</a>
</div>
